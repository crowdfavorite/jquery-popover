/*!
 * CF Popover
 * A lightweight framework for positioning iPad-style popover elements against triggers.
 *
 * Copyright 2011, Crowd Favorite (http://crowdfavorite.com)
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(a){var b=a.ui.position;var c=function(b,c){this.opts=a.extend({},this.opts,c);this.$trigger=a(b.get(0));this.$popover=a(this.opts.popover||this.$trigger.attr("href"));this.$popover=a(this.$popover.get(0));if(!this.$popover.hasClass("popover-before-after-applied")){this.$popover.addClass("popover-before-after-applied").prepend('<span role="presentation" class="before"/>').append('<span role="presentation" class="after"/>').hide()}};c.prototype={timeout:null,$win:a(window),opts:{my:"center bottom",at:"center top",offset:"0 0",collision:"flop flop",popover:null,thereCanBeOnlyOne:true,onShow:function(){},onHide:function(){}},flop:{left:function(c,d){var e=d.collisionPosition,f=a(this),g="flopped-x",h;h=b.flip.left(c,d);e.left!==c.left?f.addClass(g):f.removeClass(g);return h},top:function(c,d){var e=d.collisionPosition,f=a(this),g="flopped-y",h;h=b.flip.top(c,d);e.top!==c.top?f.addClass(g):f.removeClass(g);return h}},bindEvents:function(){this.$trigger.click(a.proxy(function(b){if(this.popoverIsOpen()){this.hidePopover(b)}else{this.showPopover(b)}if(this.opts.thereCanBeOnlyOne){a("body").trigger("popover-hide-all")}},this));a("body").click(a.proxy(function(b){if(this.popoverIsOpen()){if(!a(this.$popover).has(a(b.target)).size()&&!a(this.$popover).filter(a(b.target)).size()){this.hide()}}},this)).bind("popover-hide-all",a.proxy(function(){if(this.popoverIsOpen()&&!this.currentTrigger()){this.hide(true)}},this));this.$win.resize(a.proxy(this.pinToTargetDebounced,this))},popoverIsOpen:function(){var a=this.$trigger.length==this.$trigger.filter(this.$popover.data("opener")).length;return this.$popover.is(":visible")&&a},currentTrigger:function(){return this.$trigger.length==this.$trigger.filter(a.fn.popover.lastTrigger).length},show:function(b){this.opts.onShow();a.fn.popover.lastTrigger=this.$trigger;this.$popover.fadeIn("medium",a.proxy(function(){this.$trigger.trigger("popover-show-animation-complete")},this)).data("opener",this.$trigger);this.pinToTarget();this.$trigger.trigger("popover-show")},hide:function(b){var c=a.proxy(function(){this.$trigger.trigger("popover-hide-animation-complete")},this);if(b){this.$popover.hide(0,c)}else{this.$popover.fadeOut("fast",c)}this.$trigger.trigger("popover-hide");this.opts.onHide()},showPopover:function(a){a.preventDefault();a.stopPropagation();this.show(a)},hidePopover:function(a){a.preventDefault();a.stopPropagation();this.hide()},pinToTarget:function(){var c=this.$popover,d=a.extend({of:this.$trigger},this.opts),e={left:a.proxy(this.flop.left,this.$popover),top:a.proxy(this.flop.top,this.$popover)};b.flop=e;c.position(d);b.flop=undefined},pinToTargetDebounced:function(){clearTimeout(this.timeout);this.timeout=setTimeout(a.proxy(this.pinToTarget,this),50)}};var d=a.fn;d.popover=function(b){var c=d.popover.Popover;this.each(function(){var d=a(this);var e=new c(d,b);e.bindEvents();d.data("popover",e)});return this};d.popover.lastTrigger=null;d.popover.Popover=c})(jQuery)
