/*!
 * CF Popover v1.1
 * A lightweight framework for positioning iPad-style popover elements against triggers.
 *
 * Copyright 2011-2012, Crowd Favorite (http://crowdfavorite.com)
 * Released under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(d){var a=d.ui.position;var c=function(e,f){this.opts=d.extend({},this.opts,f);this.$trigger=d(e.get(0));this.$popover=d((this.opts.popover||this.$trigger.attr("href")));this.$popover=d(this.$popover.get(0));if(!this.$popover.hasClass("popover-before-after-applied")){this.$popover.addClass("popover-before-after-applied").prepend('<span role="presentation" class="before"/>').append('<span role="presentation" class="after"/>').hide()}};c.prototype={timeout:null,$win:d(window),opts:{my:"center bottom",at:"center top",offset:"0 0",collision:"flop flop",popover:null,thereCanBeOnlyOne:true},flop:{left:function(f,i){var e=i.collisionPosition,h=d(this);var g=a.flip.left(f,i);if(f.left!==undefined){h.toggleClass("flopped-x",e.left!==f.left)}return g},top:function(f,i){var e=i.collisionPosition,h=d(this);var g=a.flip.top(f,i);if(f.top!==undefined){h.toggleClass("flopped-y",e.top!==f.top)}return g}},positionPopover:function(e,i){var g=d(this);if(i){var f=g.data("opener"),h=d(f).data("popover");if(h&&h.opts&&h.opts.my){var j=h.opts.my.split(" ");if(j.length>0){g.toggleClass("flopped-x",i.horizontal!==j[0]);g.toggleClass("flopped-y",i.vertical!==(j.length>1?j[1]:j[0]))}}}g.css(e)},bindEvents:function(){this.$trigger.click(d.proxy(function(f){if(this.popoverIsOpen()){this.hidePopover(f)}else{this.showPopover(f)}if(this.opts.thereCanBeOnlyOne){d("body").trigger("popover-hide-all")}},this));d("body").click(d.proxy(function(f){if(this.popoverIsOpen()){if(!d(this.$popover).has(d(f.target)).size()&&!d(this.$popover).filter(d(f.target)).size()){this.hide()}}},this)).bind("popover-hide-all",d.proxy(function(){if(this.popoverIsOpen()&&!this.currentTrigger()){this.hide(true)}},this));this.$win.resize(d.proxy(this.pinToTargetDebounced,this))},popoverIsOpen:function(){var e=(this.$trigger.length==this.$trigger.filter(this.$popover.data("opener")).length);return(this.$popover.is(":visible")&&e)},currentTrigger:function(){return(this.$trigger.length==this.$trigger.filter(d.fn.popover.lastTrigger).length)},show:function(f){d.fn.popover.lastTrigger=this.$trigger;this.$popover.fadeIn("medium",d.proxy(function(){this.$trigger.trigger("popover-show-animation-complete")},this)).data("opener",this.$trigger);this.pinToTarget();this.$trigger.trigger("popover-show")},hide:function(e){var f=d.proxy(function(){this.$trigger.trigger("popover-hide-animation-complete")},this);if(e){this.$popover.hide(0,f)}else{this.$popover.fadeOut("fast",f)}this.$trigger.trigger("popover-hide")},toggle:function(e){if(this.popoverIsOpen()){this.hide(e)}else{this.show()}},showPopover:function(f){f.preventDefault();f.stopPropagation();this.show(f)},hidePopover:function(f){f.preventDefault();f.stopPropagation();this.hide()},pinToTarget:function(){if(!this.popoverIsOpen()){return}var e=this.$popover,g=d.extend({of:this.$trigger,using:this.positionPopover},this.opts),f={left:d.proxy(this.flop.left,this.$popover),top:d.proxy(this.flop.top,this.$popover)};a.flop=f;e.position(g);a.flop=undefined},pinToTargetDebounced:function(){clearTimeout(this.timeout);this.timeout=setTimeout(d.proxy(this.pinToTarget,this),50)}};var b=d.fn;b.popover=function(f){var e=b.popover.Popover;this.each(function(){var h=d(this);var g=new e(h,f);g.bindEvents();h.data("popover",g)});return this};b.popover.lastTrigger=null;b.popover.Popover=c})(jQuery);